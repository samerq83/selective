# ๐ ููุฎุต ุชูููุฐ ุญู ุฑูุน ุงููููุงุช ูู MongoDB

## ๐ ุงูุญุงูุฉ: โ ุชู ุงูุชูููุฐ ุจูุฌุงุญ

ุงูุชุงุฑูุฎ: 1 ููููุจุฑ 2024

---

## ๐ฏ ุงููุดููุฉ ุงูุฃุตููุฉ

ุนูุฏ ุฑูุน ููู ุทูุจ ุดุฑุงุก (PDF) ุนูู Netlify:
- โ ุฎุทุฃ: `ERR_CONNECTION_CLOSED`
- โ ูุดู API: `POST https://selectiveco.netlify.app/api/orders`
- โ ุงูุณุจุจ: Netlify ูุง ูุณูุญ ุจูุชุงุจุฉ ุงููููุงุช ุนูู filesystem ุจุดูู ุฏุงุฆู

---

## ๐ก ุงูุญู ุงููุทุจู

### ุงููุฑุญูุฉ 1: ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ๐
ุชู ุญูุธ ูุณุฎ ุงุญุชูุงุทูุฉ ูู:
- `models/Order.ts` โ `.zencoder/backups/Order.ts.bak`
- `app/api/orders/route.ts` โ `.zencoder/backups/orders.route.ts.bak`

**ููุงุท ุงูุชุฑุงุฌุน ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุนูุฏ ุงูุญุงุฌุฉ**

---

### ุงููุฑุญูุฉ 2: ุชุนุฏูู ุงููููุฐุฌ ๐ฆ

**ููู:** `models/Order.ts`

```typescript
// ูุจู:
purchaseOrderFile?: {
  filename: string;
  path: string;
};

// ุจุนุฏ:
purchaseOrderFile?: {
  filename: string;
  path?: string; // โ ุงุฎุชูุงุฑู ููุชูุงูู
  contentType?: string; // ๐ ููุน ุงูููู
  data?: string; // ๐ฆ Base64 data
  uploadedAt?: Date; // โฐ ููุช ุงูุฑูุน
};
```

**ุงูุชุฃุซูุฑ:**
- โ ุชูุงูู ูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ
- โ ุฏุนู ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ
- โ ุชุชุจุน ููุช ุงูุฑูุน

---

### ุงููุฑุญูุฉ 3: ุชุนุฏูู API ุงูุทูุจุงุช ๐ค

**ููู:** `app/api/orders/route.ts`

**ุงูุชุบููุฑุงุช:**
1. โ ุญุฐู: `import { writeFile, mkdir } from 'fs/promises'`
2. โ ุญุฐู: `import { join } from 'path'`
3. โ ุฅุถุงูุฉ: ุชุญููู ุงููููุงุช ุฅูู Base64

**ููุฏ ุฌุฏูุฏ:**
```typescript
// ูุจู: ุญูุธ ุนูู filesystem (ุบูุฑ ูุนูู ุนูู Netlify)
await writeFile(filepath, buffer);
purchaseOrderFile = {
  filename: fileData.name,
  path: `/uploads/purchase-orders/${filename}`,
};

// ุจุนุฏ: ุญูุธ ูู MongoDB (ูุนูู ูู ูู ููุงู)
const base64Data = buffer.toString('base64');
purchaseOrderFile = {
  filename: fileData.name,
  contentType: fileData.type || 'application/octet-stream',
  data: base64Data,
  uploadedAt: new Date(),
};
```

**ุงูููุงุฆุฏ:**
- โ ูุนูู ุนูู Netlify ุจุฏูู ูุดุงูู
- โ ูุง ุญุงุฌุฉ ููุฌูุฏ uploads
- โ ุงูููู ูุญููุธ ูุน ุงูุจูุงูุงุช ูู MongoDB

---

### ุงููุฑุญูุฉ 4: API ุฌุฏูุฏ ููุชุญููู ๐ฅ

**ููู:** `app/api/orders/download-file/route.ts` (ุฌุฏูุฏ)

**ุงููุธููุฉ:**
```
GET /api/orders/download-file?orderId=<ORDER_ID>
```

**ุงูููุฒุงุช:**
- โ ุงุณุชุฑุฌุงุน ุงูููู ูู MongoDB
- โ ูู ุชุดููุฑ Base64 ุฅูู ุจูุงูุงุช ุซูุงุฆูุฉ
- โ ุฅุฑุฌุงุน ุงูููู ูุน headers ุตุญูุญุฉ
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

**ุงูุฃูุงู:**
- ูุชุญูู ูู Authorization
- ููุท ุงููุงูู ุฃู Admin ูููููู ุงูุชุญููู
- ูุนุงูุฌุฉ ุขููุฉ ูููููุงุช

---

## โ ุงูุชุญูู ูู ุงูุชูููุฐ

### 1. ุงููููุงุช ุงููุนุฏูุฉ โ
- [x] `models/Order.ts` - ุชู ุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ
- [x] `app/api/orders/route.ts` - ุชู ุชุญุฏูุซ ููุฏ ุฑูุน ุงููููุงุช
- [x] `app/api/orders/download-file/route.ts` - ููู ุฌุฏูุฏ

### 2. ุงูุชูุซูู โ
- [x] `.zencoder/rules/repo.md` - ูุญุฏูุซ ุจุงูุชุบููุฑุงุช
- [x] `.zencoder/IMPLEMENTATION_SUMMARY.md` - ูุฐุง ุงูููู
- [x] `.zencoder/backups/CHANGES_SUMMARY.md` - ุชูุงุตูู ุงูุชุบููุฑุงุช

### 3. ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ โ
- [x] `.zencoder/backups/Order.ts.bak`
- [x] `.zencoder/backups/orders.route.ts.bak`

---

## ๐งช ุงูุงุฎุชุจุงุฑ ุงููุทููุจ

### ุงุฎุชุจุงุฑ ูุญูู:
```bash
# 1. ุดุบู ุงูุณูุฑูุฑ
npm run dev

# 2. ูู ุตูุญุฉ "ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ"
- ุฃุถู ุนุฏุฉ ููุชุฌุงุช
- ุฃุฑูุน ููู PDF
- ุงุถุบุท "ุญูุธ"

# 3. ุชุญูู ูู MongoDB:
# ูุฌุจ ุฃู ุชุฑู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ูู purchaseOrderFile.data
```

### ุงุฎุชุจุงุฑ ุนูู Netlify:
```
1. ุฃุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub
2. ุงูุชุธุฑ ุจูุงุก Netlify
3. ุฌุฑุจ ุฑูุน ููู ูู https://selectiveco.netlify.app
4. ุชุญูู ูู ุนุฏู ูุฌูุฏ ERR_CONNECTION_CLOSED
```

---

## ๐ ุงูููุงุฑูุฉ ูุจู ูุจุนุฏ

| ุงูููุฒุฉ | ูุจู โ | ุจุนุฏ โ |
|--------|--------|--------|
| ูุนูู ูุญูููุง | โ | โ |
| ูุนูู ุนูู Netlify | โ | โ |
| ุชุฎุฒูู ุงููููุงุช | filesystem | MongoDB |
| ุงููููุงุช ูุณุชูุฑุฉ | โ | โ |
| ูุน ุงูุจูุงูุงุช | โ | โ |
| ุชูุงูู ุงูุฅุตุฏุงุฑ | โ | โ |
| ุฃูุงู ุฃูุถู | - | โ |

---

## ๐ ุฎุทุฉ ุงูุชุฑุงุฌุน (ุฅู ูุฒู ุงูุฃูุฑ)

ุฅุฐุง ุญุฏุซุช ูุดุงูู:

```bash
# 1. ุงุณุชุฑุฌุน ุงููููุงุช ุงูุฃุตููุฉ
cp .zencoder/backups/Order.ts.bak models/Order.ts
cp .zencoder/backups/orders.route.ts.bak app/api/orders/route.ts

# 2. ุญุฐู ุงูููู ุงูุฌุฏูุฏ
rm app/api/orders/download-file/route.ts

# 3. ุฃุฑูุน ุฅูู GitHub
git add .
git commit -m "Revert file storage changes"
git push
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ููุฑู โ
1. [x] ุชุนุฏูู ุงููููุฐุฌ
2. [x] ุชุญุฏูุซ API ุงูุทูุจุงุช
3. [x] ุฅูุดุงุก API ุงูุชุญููู
4. [x] ุชูุซูู ุงูุชุบููุฑุงุช

### ูุฑูุจ โณ
1. [ ] ุงุฎุชุจุงุฑ ูุญูู ุดุงูู
2. [ ] ุฑูุน ุฅูู GitHub
3. [ ] ุงุฎุชุจุงุฑ ุนูู Netlify
4. [ ] ุชุญุฏูุซ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (ุฅู ูุฒู)

### ูุณุชูุจูู ๐
- [ ] ุฅุถุงูุฉ ุญุฏ ุฃูุตู ูุญุฌู ุงููููุงุช ูู MongoDB
- [ ] ุชุญุณูู ุงูุฃุฏุงุก ูููููุงุช ุงููุจูุฑุฉ
- [ ] ูุณุฎ ุงุญุชูุงุทูุฉ ูู ุงููููุงุช

---

## ๐ ููุงุญุธุงุช ูููุฉ

โ๏ธ **ูุจู ุงูุฑูุน:**
- ุชุฃูุฏ ูู ุงุฎุชุจุงุฑ ูุญูู ูุงูู
- ุชุญูู ูู ุฃู MongoDB ูุชุตู
- ุงุฎุชุจุฑ ุฑูุน ูุชุญููู ููู

โ๏ธ **ุจุนุฏ ุงูุฑูุน:**
- ุงููููุงุช ุงููุฏููุฉ (ูุน path) ุณุชุจูู ููุง ูู
- ุงููููุงุช ุงูุฌุฏูุฏุฉ ุณุชูุญูุธ ูุน ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ
- ูุฏ ุชุญุชุงุฌ ูุชุญุฏูุซ ุงููุงุฌูุฉ ุฅุฐุง ูุงูุช ุชุณุชุฎุฏู ุงูุฑุงุจุท ุงููุจุงุดุฑ

โ **ุงููุฒุงูุง:**
- ุญู ุฏุงุฆู ููุดููุฉ Netlify
- ูููุงุช ูุญููุธุฉ ุจุฃูุงู ูุน ุงูุจูุงูุงุช
- ุชูุงูู ูุงูู ูุน ุงููุณุฎ ุงููุฏููุฉ

---

## ๐ ูููู ุงููููุงุช

```
models/
โโโ Order.ts โ (ูุนุฏูู)
   โโโ purchaseOrderFile: { filename, path?, contentType?, data?, uploadedAt? }

app/api/orders/
โโโ route.ts โ (ูุนุฏูู)
โ   โโโ POST: ุชุญููู ุงููููุงุช ุฅูู Base64
โโโ download-file/ โ (ุฌุฏูุฏ)
โ   โโโ route.ts: GET /api/orders/download-file?orderId=...

.zencoder/
โโโ rules/
โ   โโโ repo.md โ (ูุนุฏูู - ุชูุซูู ุงูุชุบููุฑุงุช)
โโโ backups/
โ   โโโ Order.ts.bak (ููุทุฉ ุชุฑุงุฌุน)
โ   โโโ orders.route.ts.bak (ููุทุฉ ุชุฑุงุฌุน)
โ   โโโ CHANGES_SUMMARY.md (ุชูุงุตูู)
โโโ IMPLEMENTATION_SUMMARY.md (ูุฐุง ุงูููู)
```

---

**ุขุฎุฑ ุชุญุฏูุซ:** 1 ููููุจุฑ 2024
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงููุดุฑ