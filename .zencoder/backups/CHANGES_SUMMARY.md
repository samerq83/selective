# ๐ ุชุบููุฑุงุช ุญูุธ ุงููููุงุช ูู MongoDB

## ๐ฏ ุงููุฏู
ุชุฌูุจ ูุดููุฉ Netlify ูู ุนุฏู ุงูุณูุงุญ ุจูุชุงุจุฉ ุงููููุงุช ุนูู ูุธุงู ุงููููุงุช ุจุดูู ุฏุงุฆู.

## โ ุงูุชุบููุฑุงุช ุงููููุฐุฉ

### 1. ุชุนุฏูู ูููุฐุฌ Order (`/models/Order.ts`)

**ุงููุงุฌูุฉ - IOrder:**
```typescript
purchaseOrderFile?: {
  filename: string;
  path?: string; // โ ุงุฎุชูุงุฑู ููุชูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ
  contentType?: string; // ๐ ููุน MIME (ูุซู application/pdf)
  data?: string; // ๐ฆ ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ุจุตูุบุฉ Base64
  uploadedAt?: Date; // โฐ ููุช ุงูุฑูุน
};
```

**Schema:**
- ุชู ุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ: `contentType`, `data`, `uploadedAt`
- ุงูุญููู ุงุฎุชูุงุฑูุฉ ููุชูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ

### 2. ุชุนุฏูู API ุงูุทูุจุงุช (`/app/api/orders/route.ts`)

**ุงูุชุบููุฑุงุช:**
- โ ุญุฐู ููุฏ ูุชุงุจุฉ ุงููููุงุช ุนูู filesystem
- โ ุญุฐู ุงุณุชูุฑุงุฏ `writeFile` ู `mkdir` ู `join`
- โ ุฅุถุงูุฉ ุชุญููู ุงููููุงุช ุฅูู Base64
- โ ุญูุธ ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ูุจุงุดุฑุฉ ูู MongoDB

**ููุฏ ุฌุฏูุฏ:**
```typescript
// ูุจู: ุญูุธ ุนูู filesystem
await writeFile(filepath, buffer);
purchaseOrderFile = {
  filename: fileData.name,
  path: `/uploads/purchase-orders/${filename}`,
};

// ุจุนุฏ: ุญูุธ ูู MongoDB
const base64Data = buffer.toString('base64');
purchaseOrderFile = {
  filename: fileData.name,
  contentType: fileData.type || 'application/octet-stream',
  data: base64Data,
  uploadedAt: new Date(),
};
```

### 3. API ุฌุฏูุฏ ูุชุญููู ุงููููุงุช (`/app/api/orders/download-file/route.ts`)

**ุงูููุฒุงุช:**
- โ ุงุณุชุฑุฌุงุน ุงูููู ูู MongoDB
- โ ูู ุชุดููุฑ Base64 ุฅูู Buffer
- โ ุฅุฑุฌุงุน ุงูููู ูุน headers ุตุญูุญุฉ
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (ุงููุณุชุฎุฏู ุฃู Admin ููุท)
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุฎุชููุฉ

**ุงูุงุณุชุฎุฏุงู:**
```
GET /api/orders/download-file?orderId=<ORDER_ID>
```

## ๐ ููุงุท ุงูุชุฑุงุฌุน

ุชู ุญูุธ ูุณุฎ ุงุญุชูุงุทูุฉ ูู:
- `/.zencoder/backups/Order.ts.bak`
- `/.zencoder/backups/orders.route.ts.bak`

## ๐งช ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงููุทููุจุฉ

1. **ุงุฎุชุจุงุฑ ูุญูู** โ 
   - ุชุดุบูู ุงูุณูุฑูุฑ ูุญูููุง
   - ูุญุงููุฉ ุฑูุน ููู ุทูุจ ุดุฑุงุก
   - ุงูุชุญูู ูู ุญูุธ ุงูููู ูู MongoDB

2. **ุงุฎุชุจุงุฑ ุงูุชุญููู** โ
   - ุงุณุชุฏุนุงุก `/api/orders/download-file?orderId=<id>`
   - ุงูุชุญูู ูู ุชุญููู ุงูููู ุงูุตุญูุญ

3. **ุชุญุฏูุซ ุงููุงุฌูุฉ (ุฅู ูุฒู ุงูุฃูุฑ)** โณ
   - ุฅุฐุง ูุงู ููุฌุฏ ุฑุงุจุท ุชุญููู ุงูููู ูู ุงููุงุฌูุฉุ ูุฏ ูุญุชุงุฌ ุชุญุฏูุซ
   - ูู `href="/uploads/..."` ุฅูู `href="/api/orders/download-file?orderId=..."`

4. **ุงุฎุชุจุงุฑ ุนูู Netlify** โ
   - ุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub
   - ุงุฎุชุจุงุฑ ุฑูุน ุงููููุงุช ุนูู Netlify

## โ๏ธ ููุงุญุธุงุช ูููุฉ

- ุงูุจูุงูุงุช ุงููุฏููุฉ ุจูุธุงู ุงููููุงุช ูู ุชุนูุฏ ูุจุงุดุฑุฉ ูุชุงุญุฉ
- ุงููููุงุช ุงูุฌุฏูุฏุฉ ุณุชูุญูุธ ูู MongoDB ุจุฏูุงู ูู filesystem
- ูุง ุญุงุฌุฉ ูุชุญุฏูุซ endpoint ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุฅุฐุง ูุงูุช ุชุณุชุฎุฏู ุงูุฑุงุจุท ุงููุจุงุดุฑ (ุณูููู ุงูุชุญููู ุนุจุฑ API ุจุฏูุงู ูู static)

## ๐ ุงูููุงุฆุฏ

โ ุชุฌูุจ ูุดููุฉ Netlify  
โ ุงููููุงุช ูุญููุธุฉ ุจุฃูุงู ูุน ุงูุจูุงูุงุช  
โ ุชูุงูู ูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ  
โ ุณูู ุงูุชูุณุน (ุฅุถุงูุฉ metadata ุฃุฎุฑู)